{% extends "admin_base/admin_base.html" %}
{% import "flask_bombril_macros/utils.html" as utils with context %}
{% import "flask_bombril_macros/messages.html" as messages with context %}
{% block subtitle %}
    {{ R.string.clients }}
{% endblock %}
{% block content %}
    <div class="__admin_clients__ __index__ container">
        {% for client in data.clients_in_page %}
            <div id="modal-{{ loop.index0 }}" class="modal fade details" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">{{ R.string.client_details_modal_title(client.first_name) }}</h4>
                        </div>
                        <div class="modal-body example">
                            <div class="page-header">
                                <h4>{{ R.string.client_data }}</h4>
                            </div>
                            {% with client_form=client.get_form(include_undefined_in_choices=True), readonly=True %}
                                {% include "components/client_panel_form.html" %}
                            {% endwith %}
                            <div class="page-header">
                                <h4>{{ R.string.orders_of_client }}</h4>
                            </div>
                            {% if client.orders and client.orders|length > 0 %}
                                {% for order in client.orders %}
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">
                                                {{ R.string.order_panel_title(order.id) }}
                                                <span class="date">{{ R.string.get_formatted_date(order.paid_datetime) }}</span>
                                            </h4>
                                        </div>
                                        <div class="panel-body">
                                            {% with data=order.get_products_table_data() %}
                                                {% include "components/super_table.html" %}
                                            {% endwith %}
                                            {% with data=order.get_total_table_data() %}
                                                {% include "components/super_table.html" %}
                                            {% endwith %}
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <p>{{ R.string.no_orders_registered }}</p>
                            {% endif %}
                            {#                            {% with data=order.get_products_table_data() %}#}
                            {#                                {% include "components/super_table.html" %}#}
                            {#                            {% endwith %}#}
                            {#                            <div class="page-header">#}
                            {#                                <h4>{{ R.string.order_total_value }}</h4>#}
                            {#                            </div>#}
                            {#                            {% with data=order.get_total_table_data() %}#}
                            {#                                {% include "components/super_table.html" %}#}
                            {#                            {% endwith %}#}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default"
                                    data-dismiss="modal">{{ R.string.close }}</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}

        {{ utils.page_header(R.string.clients) }}
        {% with data=data %}
            {% include "components/super_table.html" %}
        {% endwith %}
    </div>
{% endblock %}
{% block script %}
    <script>
        initSuperTable();
    </script>
{% endblock %}
