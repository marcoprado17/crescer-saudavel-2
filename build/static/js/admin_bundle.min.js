function initFacebookLoginButton(){$("button.btn-facebook").each(function(){var t=$(this),e=t.attr("data-error-msg"),n=t.siblings(".loading-text"),r=t.attr("data-connect-url");console.log(r);var a=t.attr("data-home-url");t.click(function(){FB.login(function(o){o.authResponse?(t.prop("disabled",!0),n.removeClass("hidden"),$.ajax({type:"POST",url:r,data:o.authResponse.accessToken,processData:!1,contentType:"application/octet-stream; charset=utf-8",success:function(t){window.location.href=a},error:function(t){dataAsObject=getDataAsObject(t.responseText),throwErrorOpToast(null!=dataAsObject&&"error"in dataAsObject?dataAsObject.error:e)},complete:function(){t.prop("disabled",!1),n.addClass("hidden")}})):throwErrorOpToast(e)},{scope:"email"})})})}function initVerticalFluid(){$(document).ready(function(){var t=0,e=$(".vertical-fluid"),n=e.first();n.next().removeClass("hidden");var r=n.parent().height();n.siblings().each(function(){var e=$(this);e.hasClass("vertical-fluid")||(t+=e.outerHeight(!0))});var a=(r-t)/2;e.each(function(){$(this).height(a)})})}function initAllDateTimePickers(){$(".datetimepicker").each(function(){dateAsString=$(this).find("input").attr("data-date-as-string"),date=new Date(dateAsString),""==dateAsString&&(date=new Date),$(this).datetimepicker({locale:"pt-br",format:"DD/MM/YYYY"}),$(this).data("DateTimePicker").date(moment(date))})}function getDataAsObject(t){try{return JSON.parse(t)}catch(t){return null}}function setAjaxButtonHandlers(t){var e=t.button,n=t.url,r=t.method,a=t.minResponseTime,o=t.confirmMessage,i=t.onClick,s=t.success,c=t.error,l=t.complete;e.click(function(t){if(o){if(!confirm(o))return!1}a||(a=0);var u=i();return e.clickTime=(new Date).getTime(),$.ajax({url:n,method:r,data:u,contentType:"application/json;charset=UTF-8",async:!0,success:function(t){console.log(t);var n=(new Date).getTime(),r=a-(n-e.clickTime);setTimeout(function(){s(getDataAsObject(t)),l&&l()},r)},error:function(t){var n=(new Date).getTime(),r=a-(n-e.clickTime);setTimeout(function(){c(t.status,getDataAsObject(t.responseText)),l&&l()},r)}}),!0})}function setAjaxFormHandlers(t){var e=t.form,n=t.minResponseTime,r=t.confirmMessage,a=t.onSubmit,o=t.success,i=t.error,s=t.complete;e.find("button[type='submit']");e.submit(function(t){if(t.preventDefault(),r){if(!confirm(r))return!1}return n||(n=0),submitReturn=a(),0!=submitReturn&&(e.clickTime=(new Date).getTime(),$.ajax({url:e.attr("action"),method:e.attr("method"),data:e.serialize(),async:!0,success:function(t){var r=(new Date).getTime(),a=n-(r-e.clickTime);setTimeout(function(){o(getDataAsObject(t)),s&&s()},a)},error:function(t){var r=(new Date).getTime(),a=n-(r-e.clickTime);setTimeout(function(){i(t.status,getDataAsObject(t.responseText)),s&&s()},a)}}),!0)})}function throwSuccessOpToast(t){toastr.options.closeButton=!1,toastr.options.timeOut=SUCCESS_TOAST_TIME_OUT,toastr.success(t)}function throwInfoOpToast(t){toastr.options.closeButton=!0,toastr.options.timeOut=INFO_TOAST_TIME_OUT,toastr.info(t)}function throwWarningOpToast(t){toastr.options.closeButton=!0,toastr.options.timeOut=WARNING_TOAST_TIME_OUT,toastr.warning(t)}function throwErrorOpToast(t){toastr.options.closeButton=!0,toastr.options.timeOut=ERROR_TOAST_TIME_OUT,toastr.error(t)}function initTooltips(){$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()})}function initDynamicSelects(){$("select.dynamic").each(function(){var t=$(this),e=t.closest("form").find("#{0}".f(t.attr("depends_on"))),n=t.attr("dependent_choices"),r=JSON.parse(n),a=t.val(),o=e.find("option:selected").attr("value"),i=r[o];t.empty(),i.forEach(function(e){t.append($("<option></option>").attr("value",e[0]).text(e[1]))}),i.forEach(function(e){e[0]==a&&t.val(a)}),e.change(function(){var n=e.find("option:selected").attr("value"),a=r[n];t.empty(),a.forEach(function(e){t.append($("<option></option>").attr("value",e[0]).text(e[1]))})})})}function clearErrors(t){t.find("span.error").remove(),t.find(".has-error").removeClass("has-error")}function showFormErrors(t,e){clearErrors(t);for(var n in e)if(e.hasOwnProperty(n))if(input=t.find("input[name='{0}']".f(n)),select=t.find("select[name='{0}']".f(n)),textarea=t.find("textarea[name='{0}']".f(n)),arrayOfErrors=e[n],1==input.length){input.parent().addClass("has-error");for(var r=0;r<arrayOfErrors.length;r++)input.after("<span class='help-block error'>{0}</span>".f(arrayOfErrors[r]))}else if(1==select.length){select.parent().addClass("has-error");for(var r=0;r<arrayOfErrors.length;r++)select.after("<span class='help-block error'>{0}</span>".f(arrayOfErrors[r]))}else if(1==textarea.length){textarea.parent().addClass("has-error");for(var r=0;r<arrayOfErrors.length;r++)textarea.after("<span class='help-block error'>{0}</span>".f(arrayOfErrors[r]))}}function initSaveForms(){$("form.save").each(function(){var t=$(this),e=t.find("input[type='submit']"),n=t.attr("data-save-text"),r=t.attr("data-saving-text"),a=t.attr("data-error-msg"),o=t.attr("data-success-msg");setAjaxFormHandlers({form:t,minResponseTime:800,onSubmit:function(){e.val(r),e.prop("disabled",!0)},success:function(){clearErrors(t),throwSuccessOpToast(o)},error:function(e,n){400==e&&null!=n&&"errors"in n&&showFormErrors(t,n.errors),throwErrorOpToast(a)},complete:function(){e.val(n),e.prop("disabled",!1)}})})}function initAllTelInput(){$("input.tel").each(function(){var t=$(this);t.keypress(function(e){if(13==e.keyCode)return!0;var n=String.fromCharCode(e.which);if("0123456789".indexOf(n)<0)return!1;var r=t.val().length;0==r?t.val("("):3==r?t.val(t.val()+") "):9==r?t.val(t.val()+"-"):14==r&&"-"!=t.val()[10]&&(old_tel=t.val(),sub_1=old_tel.substring(0,9),sub_2=old_tel.substring(11),t.val(sub_1+old_tel[10]+"-"+sub_2))}),t.keyup(function(){var e=t.val().length;e>=11&&e<15&&"-"==t.val()[10]?(old_tel=t.val(),sub_1=old_tel.substring(0,9),sub_2=old_tel.substring(11),t.val(sub_1+"-"+old_tel[9]+sub_2)):10==e&&"-"!=t.val()[9]&&(old_tel=t.val(),sub_1=old_tel.substring(0,9),t.val(sub_1+"-"+old_tel[9]))})})}function initAllCepInput(){$("input.cep").each(function(){var t=$(this);t.keypress(function(e){if(13==e.keyCode)return!0;var n=String.fromCharCode(e.which);if("0123456789".indexOf(n)<0)return!1;var r=t.val().length;if(5==r)t.val(t.val()+"-");else if(9==r)return!1})})}function bigNumberToFormattedPrice(t){return s="R$ ",s+=t.toFixed(2).replace(".",","),s}function initPriceWithDiscountCalc(){$("input[type=checkbox].change-price-with-discount").bind("change",function(){if(this.checked)recalcPriceWithDiscount();else{$("input.price-with-discount").val("-")}}),$("input[type=number].change-price-with-discount").bind("keyup mouseup",function(){$("input[type=checkbox].change-price-with-discount").prop("checked")&&recalcPriceWithDiscount()}),$("input[type=text].change-price-with-discount").bind("keyup",function(){$("input[type=checkbox].change-price-with-discount").prop("checked")&&recalcPriceWithDiscount()})}function recalcPriceWithDiscount(){console.log("Recalculando preÃ§o com desconto");var t=$("input.price-with-discount"),e=$("input.price").val(),n=$("input.discount-percentage").val(),r=t.attr("data-url");t.val("Calculando..."),$.ajax({url:r,method:"post",data:{price:e,discount_percentage:n},success:function(e){dataAsObject=getDataAsObject(e),t.val(dataAsObject.price_with_discount)},error:function(){t.val("Erro!")}})}function initAllMarkdownTextArea(){$("button.markdown.preview").each(function(){var t=$(this),e=$("{0}".f(t.attr("data-target"))),n=t.attr("data-url"),r=t.attr("data-loading-message"),a=t.attr("data-error-message"),o=e.find(".modal-body"),i=$("{0}".f(t.attr("data-textarea")));setAjaxButtonHandlers({button:t,url:n,method:"post",contentType:"application/json;charset=UTF-8",minResponseTime:900,onClick:function(){return o.html(r),console.log("onClick"),JSON.stringify({markdown_text:i.val()},null,"\t")},success:function(t){null!=t&&"markdown_html"in t?o.html(t.markdown_html):o.html(a)},error:function(){console.log("error"),o.html(a)}})})}function initAllDynamicSelects(){$("select.dynamic").each(function(){var t=$(this),e=$("select[id={0}]".f(t.attr("determinant-select-id")));onDeterminantSelectChange(t,e),e.on("change",function(){onDeterminantSelectChange(t,e)})})}function onDeterminantSelectChange(t,e){var n=e.val();if(null!=n){var r=JSON.parse(t.attr("dynamic-choices-data"));options=[],r[n.toString()].forEach(function(t){options.push(new Option(t[1],parseInt(t[0])))}),t.find("option[value]").remove(),t.append(options).val("").trigger("change")}}DEFAULT_RESPONSE_TIME=500,SUCCESS_TOAST_TIME_OUT=3500,ERROR_TOAST_TIME_OUT=1e4,WARNING_TOAST_TIME_OUT=8e3,INFO_TOAST_TIME_OUT=1e4,String.prototype.format=String.prototype.f=function(){for(var t=this,e=arguments.length;e--;)t=t.replace(new RegExp("\\{"+e+"\\}","gm"),arguments[e]);return t};